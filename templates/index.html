<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Multiplayer Cursor Game</title>
    <style>
        body {
            background-color: white;
            overflow: hidden;
        }
        .cursor {
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            pointer-events: none;
        }
        #leaderboard {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: white;
            border: 1px solid black;
            padding: 10px;
        }
    </style>
    <div id="leaderboard"></div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.0/socket.io.js"></script>
</head>
<body>
    <script>
        const socket = io();
        const myId = Math.random().toString(36).substr(2, 9); // Unique ID for this client

        document.addEventListener('mousemove', (event) => {
            socket.emit('move_cursor', { id: myId, x: event.clientX, y: event.clientY });
        });

        socket.on('update_cursors', (data) => {
            const { positions, distances } = data;
            const currentIds = Object.keys(positions);

            currentIds.forEach(id => {
                updateCursor(id, positions[id]);
            });

            removeDisconnectedCursors(currentIds);
            updateLeaderboard(distances);
        });

        function updateLeaderboard(distances) {
            const leaderboard = document.getElementById('leaderboard');
            leaderboard.innerHTML = '<h4>Leaderboard (Distance in Pixels)</h4>';
            Object.entries(distances)
                .sort((a, b) => b[1] - a[1]) // Sort by distance, descending
                .forEach(([id, distance]) => {
                    leaderboard.innerHTML += `<p>${id}: ${Math.round(distance)}px</p>`;
                });
        }      

        function updateCursor(id, pos) {
            let cursor = document.getElementById(id);
            if (!cursor) {
                cursor = document.createElement('div');
                cursor.id = id;
                cursor.classList.add('cursor');
                cursor.style.backgroundColor = getRandomColor();
                document.body.appendChild(cursor);
            }
            cursor.style.left = pos.x + 'px';
            cursor.style.top = pos.y + 'px';
        }

        function getRandomColor() {
            const letters = '0123456789ABCDEF';
            let color = '#';
            for (let i = 0; i < 6; i++) {
                color += letters[Math.floor(Math.random() * 16)];
            }
            return color;
        }

        function removeDisconnectedCursors(currentIds) {
            const allCursorElements = document.getElementsByClassName('cursor');
            Array.from(allCursorElements).forEach(cursorElem => {
                if (!currentIds.includes(cursorElem.id)) {
                    cursorElem.remove();
                }
            });
        }
    </script>
</body>
</html>
